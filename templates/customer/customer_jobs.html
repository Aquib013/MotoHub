{% extends "base.html" %}
{% load custom_tags %}

{% block content %}
<h1>Jobs for {{ customer.customer_name }}</h1>

<p>Total Dues: {{ total_dues }}</p>
<p>Total Balance: {{ total_balance }}</p>

{% if jobs %}
<table class="table table-striped table-hover">
    <thead class="thead-dark">
        <tr>
            <th>Job No</th>
            <th>Job Date</th>
            <th>Job Amount</th>
            <th>Paid Amount</th>
            <th>Due/Balance</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for job in jobs %}
        <tr>
            <td>{{ job.job_no }}</td>
            <td>{{ job.created_at.date }}</td>
            <td>{{ job.job_amount }}</td>
            <td>{{ job.paid_amount }}</td>
            <td>
                {% if job.paid_amount < job.job_amount %}
                    Due: {{ job.job_amount|sub:job.paid_amount }}
                {% elif job.paid_amount > job.job_amount %}
                    Balance: {{ job.paid_amount|sub:job.job_amount }}
                {% else %}
                    Settled
                {% endif %}
            </td>
            <td>
              <div class="d-flex flex-wrap gap-2">
                    <a href="{% url 'customer-job-detail' customer.pk job.pk %}" class="btn btn-sm btn-info">View</a>
              </div>
            </td>
        </tr>
            {% endfor %}
        </tbody>
</table>
{% else %}
    <div class="alert alert-info" role="alert">
      No Jobs found for this Customer.
    </div>
  {% endif %}
    <div class="d-flex justify-content-center mb-4">
    <a href="{% url 'customers' %}" class="btn btn-secondary">Back to Customers List</a>
    </div>
{% endblock %}